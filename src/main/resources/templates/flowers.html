<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Управление цветами</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; margin: 0; padding: 0; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        h1 { color: #e91e63; text-align: center; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
        th { background: #e91e63; color: white; }
        input, select { padding: 5px; margin: 5px; }
        .btn { padding: 5px 10px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #e91e63; color: #fff; }
        .btn-danger { background: #f44336; color: #fff; }
        .filters { margin-bottom: 15px; }
        .pagination { margin-top: 10px; text-align: center; }
        .pagination a { margin: 0 3px; padding: 5px 10px; border: 1px solid #ccc; text-decoration: none; }
        .pagination a.active { background: #e91e63; color: white; }
    </style>
</head>
<body>
<div class="container">
    <h1>Управление цветами</h1>

    <a href="/" class="btn btn-warning">На главную</a>
    <form method="get" class="filters">
        <input type="text" name="search" th:value="${searchTerm}" placeholder="Поиск по названию">
        <input type="number" step="0.01" name="minPrice" th:value="${filterMinPrice}" placeholder="Мин. цена">
        <input type="number" step="0.01" name="maxPrice" th:value="${filterMaxPrice}" placeholder="Макс. цена">
        <select name="categoryId">
            <option value="">Все категории</option>
            <option th:each="cat : ${categories}" th:value="${cat.id}"
                    th:text="${cat.name}"
                    th:selected="${filterCategoryId == cat.id}"></option>
        </select>
        <button type="submit" class="btn btn-primary">Применить</button>
    </form>

    <form method="post" th:action="@{/flowers/add}" style="margin-bottom: 15px;">
        <input type="text" name="name" placeholder="Название" required>
        <select name="categoryId" required>
            <option value="">Выберите категорию</option>
            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
        </select>
        <input type="number" step="0.01" name="price" placeholder="Цена" required>
        <input type="number" name="stockQuantity" placeholder="Количество" required>
        <button type="submit" class="btn btn-primary">Добавить</button>
    </form>

    <form method="post" th:action="@{/flowers/delete-multiple}">
        <table>
            <thead>
            <tr>
                <th><input type="checkbox" onclick="toggleAll(this)"></th>
                <th>ID</th>
                <th>Название</th>
                <th>Категория</th>
                <th>Цена</th>
                <th>Количество</th>
                <th>Действия</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="flower : ${flowers}">
                <td><input type="checkbox" name="ids" th:value="${flower.id}"></td>
                <td th:text="${flower.id}"></td>
                <td th:text="${flower.name}"></td>
                <td th:text="${categoryNames[flower.categoryId]}"></td>
                <td th:text="${flower.price}"></td>
                <td th:text="${flower.stockQuantity}"></td>
                <td>
                    <form method="post" th:action="@{/flowers/update}" style="display:inline-block;">
                        <input type="hidden" name="id" th:value="${flower.id}">
                        <input type="text" name="name" th:value="${flower.name}" required>
                        <input type="number" step="0.01" name="price" th:value="${flower.price}" required>
                        <input type="number" name="stockQuantity" th:value="${flower.stockQuantity}" required>
                        <select name="categoryId" required>
                            <option th:each="cat : ${categories}" th:value="${cat.id}"
                                    th:text="${cat.name}" th:selected="${flower.categoryId == cat.id}"></option>
                        </select>
                        <button type="submit" class="btn btn-primary">Обновить</button>
                    </form>
                    <form method="post" th:action="@{/flowers/delete}" style="display:inline-block;">
                        <input type="hidden" name="id" th:value="${flower.id}">
                        <button type="submit" class="btn btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
        <button type="submit" class="btn btn-danger" style="margin-top:5px;">Удалить выбранные</button>
    </form>

    <div class="pagination" th:if="${totalPages > 1}">
        <a th:if="${currentPage > 1}"
           th:href="@{/flowers(page=${currentPage-1}, size=${pageSize}, search=${searchTerm}, minPrice=${filterMinPrice}, maxPrice=${filterMaxPrice}, categoryId=${filterCategoryId})}">&laquo; Назад</a>

        <a th:each="p : ${#numbers.sequence(1, totalPages)}"
           th:href="@{/flowers(page=${p}, size=${pageSize}, search=${searchTerm}, minPrice=${filterMinPrice}, maxPrice=${filterMaxPrice}, categoryId=${filterCategoryId})}"
           th:text="${p}"
           th:classappend="${p == currentPage} ? 'active' : ''"></a>

        <a th:if="${currentPage < totalPages}"
           th:href="@{/flowers(page=${currentPage+1}, size=${pageSize}, search=${searchTerm}, minPrice=${filterMinPrice}, maxPrice=${filterMaxPrice}, categoryId=${filterCategoryId})}">Вперед &raquo;</a>
    </div>


</div>

<script>
    function toggleAll(source) {
        checkboxes = document.getElementsByName('ids');
        for(var i=0, n=checkboxes.length;i<n;i++) {
            checkboxes[i].checked = source.checked;
        }
    }
</script>
</body>
</html>
