<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Цветы</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #fafafa; color: #222; margin: 0; padding: 0; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; margin-bottom: 20px; font-weight: 500; }
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th, td { padding: 8px; border-bottom: 1px solid #ddd; text-align: center; }
        th { color: #555; font-weight: 500; }
        input, select { padding: 4px; margin: 2px; font-size: 0.9rem; }
        .btn { padding: 4px 8px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem; }
        .btn-primary { background: #4caf50; color: #fff; }
        .btn-danger { background: #e53935; color: #fff; }
        .btn-warning { background: #ff9800; color: #222; }
        .filters { margin-bottom: 15px; text-align: center; }
        .pagination { margin-top: 10px; text-align: center; }
        .pagination a { margin: 0 3px; padding: 4px 8px; border-radius: 3px; border: 1px solid #ddd; text-decoration: none; color: #555; font-size: 0.85rem; }
        .pagination a.active { background: #4caf50; color: white; border-color: #4caf50; }
        .actions form { display: inline-block; margin: 0; }
    </style>
</head>
<body>
<div class="container">
    <h1>Управление цветами</h1>

    <!-- Фильтры -->
    <form method="get" class="filters">
        <input type="text" name="search" th:value="${searchTerm}" placeholder="Поиск">
        <input type="number" step="0.01" name="minPrice" th:value="${filterMinPrice}" placeholder="Мин. цена">
        <input type="number" step="0.01" name="maxPrice" th:value="${filterMaxPrice}" placeholder="Макс. цена">
        <select name="categoryId">
            <option value="">Все категории</option>
            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}" th:selected="${filterCategoryId == cat.id}"></option>
        </select>
        <label>
            <input type="checkbox" name="includeArchived" th:checked="${includeArchived}"> Показать архивные
        </label>
        <button type="submit" class="btn btn-primary">Применить</button>
    </form>

    <!-- Добавление нового цветка -->
    <form method="post" th:action="@{/flowers/add}" style="margin-bottom: 15px;">
        <input type="text" name="name" placeholder="Название" required>
        <select name="categoryId" required>
            <option value="">Выберите категорию</option>
            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
        </select>
        <input type="number" step="0.01" name="price" placeholder="Цена" required>
        <input type="number" name="stockQuantity" placeholder="Количество" required>
        <button type="submit" class="btn btn-primary">Добавить</button>
    </form>

    <!-- Таблица цветов -->
    <form method="post" th:action="@{/flowers/delete-multiple}">
        <table>
            <thead>
            <tr>
                <th><input type="checkbox" onclick="toggleAll(this)"></th>
                <th>ID</th>
                <th>Название</th>
                <th>Категория</th>
                <th>Цена</th>
                <th>Количество</th>
                <th>Действия</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="flower : ${flowers}">
                <td><input type="checkbox" name="ids" th:value="${flower.id}"></td>
                <td th:text="${flower.id}"></td>
                <td th:text="${flower.name}"></td>
                <td th:text="${categoryNames[flower.categoryId]}"></td>
                <td th:text="${flower.price}"></td>
                <td th:text="${flower.stockQuantity}"></td>
                <td class="actions">
                    <!-- Обновление -->
                    <form method="post" th:action="@{/flowers/update}">
                        <input type="hidden" name="id" th:value="${flower.id}">
                        <input type="text" name="name" th:value="${flower.name}" required style="width:70px;">
                        <input type="number" step="0.01" name="price" th:value="${flower.price}" required style="width:60px;">
                        <input type="number" name="stockQuantity" th:value="${flower.stockQuantity}" required style="width:50px;">
                        <select name="categoryId" style="width:80px;">
                            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}" th:selected="${flower.categoryId == cat.id}"></option>
                        </select>
                        <button type="submit" class="btn btn-primary">Обновить</button>
                    </form>

                    <!-- Логическое удаление / архив -->
                    <form method="post" th:action="@{/flowers/soft-delete}">
                        <input type="hidden" name="id" th:value="${flower.id}">
                        <button type="submit" class="btn btn-warning" th:if="${flower.active}">Архивировать</button>
                        <span th:if="${!flower.active}" style="color:#888;">Архив</span>
                    </form>

                    <!-- Физическое удаление -->
                    <form method="post" th:action="@{/flowers/delete}">
                        <input type="hidden" name="id" th:value="${flower.id}">
                        <button type="submit" class="btn btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
        <button type="submit" class="btn btn-danger" style="margin-top:5px;">Удалить выбранные</button>
    </form>

    <!-- Пагинация -->
    <div class="pagination" th:if="${totalPages > 1}">
        <a th:if="${currentPage > 1}" th:href="@{/flowers(page=${currentPage-1}, size=${pageSize}, search=${searchTerm}, minPrice=${filterMinPrice}, maxPrice=${filterMaxPrice}, categoryId=${filterCategoryId}, includeArchived=${includeArchived})}">&laquo;</a>
        <a th:each="p : ${#numbers.sequence(1, totalPages)}"
           th:href="@{/flowers(page=${p}, size=${pageSize}, search=${searchTerm}, minPrice=${filterMinPrice}, maxPrice=${filterMaxPrice}, categoryId=${filterCategoryId}, includeArchived=${includeArchived})}"
           th:text="${p}" th:classappend="${p == currentPage} ? 'active' : ''"></a>
        <a th:if="${currentPage < totalPages}" th:href="@{/flowers(page=${currentPage+1}, size=${pageSize}, search=${searchTerm}, minPrice=${filterMinPrice}, maxPrice=${filterMaxPrice}, categoryId=${filterCategoryId}, includeArchived=${includeArchived})}">&raquo;</a>
    </div>
</div>

<script>
    function toggleAll(source) {
        document.querySelectorAll('input[name="ids"]').forEach(cb => cb.checked = source.checked);
    }
</script>
</body>
</html>
